{$SITE_ADDR::80} {
  encode zstd gzip

  # Convenience redirect (nice for a single-purpose VM)
  @rootOnly path /
  redir @rootOnly https://martilab.com 308

  @gamesNoSlash path /games
  redir @gamesNoSlash /games/ 308

  @snakeNoSlash path /games/snake
  redir @snakeNoSlash /games/snake/ 308

  @mazeNoSlash path /games/maze
  redir @mazeNoSlash /games/maze/ 308

  # WebSocket endpoint (reverse-proxied to the game server)
  handle /games/snake/ws* {
    reverse_proxy {$GAMES_BACKEND:games-backend:8080}
  }

  handle /games/maze/ws* {
    reverse_proxy {$GAMES_BACKEND:games-backend:8080}
  }

  # Static content for /games/*
  root * {$GAMES_ROOT:/srv}
  file_server
}
